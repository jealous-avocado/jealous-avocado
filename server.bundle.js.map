{"version":3,"sources":["webpack:///webpack/bootstrap 17923dcc4a4ce079316e","webpack:///./server.js","webpack:///external \"bluebird\"","webpack:///external \"body-parser\"","webpack:///external \"underscore\"","webpack:///external \"request-promise\"","webpack:///external \"express-session\"","webpack:///external \"connect-session-knex\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///./db/config.js","webpack:///external \"knex\"","webpack:///external \"bookshelf\"","webpack:///./db/models/user.js","webpack:///external \"bcrypt-nodejs\"","webpack:///./db/models/topic.js","webpack:///./db/models/article.js","webpack:///./alchemy.config.js"],"names":[],"mappings":"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","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 17923dcc4a4ce079316e\n **/","var Promise = require('bluebird');\nvar bodyParser = require('body-parser');\nvar _ = require('underscore');\nvar request = require('request-promise');\nvar bodyParser = require('body-parser')\nvar session = require('express-session');\nvar knexSessionStore = require('connect-session-knex')(session);\nvar express = require('express');\n\nvar app = express();\nvar server = require('http').Server(app);\nvar PORT = process.env.PORT || 3000;\n\nvar db = require('./db/config');\nvar User = require('./db/models/user.js');\nvar bcrypt = require('bcrypt-nodejs');\nvar Topic = require('./db/models/topic.js');\nvar Article = require('./db/models/article.js');\n\nvar alchemyAPI = require('./alchemy.config.js');\n\nvar sessionStore = new knexSessionStore({\n  knex: db.knex,\n  tablename: 'sessions'\n});\n\napp.use(bodyParser.urlencoded({     \n extended: true\n}));\napp.use(bodyParser.json());\napp.use(express.static(__dirname + '/public')); //express static will serve up index.html by default upon requesting root url\n\napp.use(session({\n  secret: 'secret',\n  resave: false,\n  saveUninitialized: true,\n  cookie: {\n    maxAge: 1000 * 60 * 60 * 24 * 7 //1 week\n  },\n  store: sessionStore\n}));\n\napp.post('/signup', function (req, res) {\n  var username = req.body.username;\n  var password = req.body.password;\n  new User({ name: username })\n    .fetch()\n    .then(function(user) {\n      if (user) {\n        res.status(403);\n        res.end('A user with that name already exists!');\n      } else {\n        bcrypt.hash(password, null, null, function(err, hash){\n          var newUser = new User({\n            name: username,\n            password: hash\n          });\n          newUser.save();\n          res.status(304);\n          res.end();\n        });\n      }\n    })\n});\n\napp.post('/signin', function (req, res) {\n var username = req.body.username;\n var password = req.body.password;\n\n new User({ name: username })\n  .fetch()\n  .then(function(user) {\n    if (!user) {\n      res.status(404);\n      res.end();\n    } else {\n      // console.log(user);\n      user.checkPassword(password, function(isMatch){\n        if(isMatch){\n          res.status(201);\n          res.end();\n        } else {\n          res.status(404);\n          res.end();\n        }\n      })\n    }\n  });\n});\n\napp.get('/signout', function (req, res) {\n //destory session \n res.redirect('/'); \n});\n\napp.get('/getArticles', (req, res) => {\n  const MAX_TIME = 86400000; //Longest time to keep articles in db.  (One day = 86400000ms)\n  var allURLS = [];\n  //only do an alchemyAPI request if necessary -- if there are cached articles, then show those first\n  var refreshArticles = function(topicId) {\n\n    Article.fetchAll({topicId: topicId}).then(function(articles){\n      articles.forEach(function(article){\n        article.destroy();\n      });\n    });\n    console.log('querying alchemyAPI for articles in ', req.query.topic);\n    request.get(alchemyAPI.getNewsURL(req.query.topic))\n    .then(d => {\n      d = JSON.parse(d);\n      d.result.docs.forEach(doc => {\n        var newArticle = new Article({\n          url: doc.source.enriched.url.url,\n          topicId: topicId\n        }).save();\n      });\n      getArticles(topicId);\n    });\n  };\n\n  //get the articles from the db\n  var getArticles = function(topicId) {\n    Article.fetchAll({topicId: topicId}).then(function(articles){\n      articles.forEach(function(article){\n        //console.log(article.get('url'), article.get('created_at'));\n        allURLS.push(article.get('url'));\n      });\n      res.json(allURLS);\n    });\n  };\n\n  //2. Are there any articles in the db? How recently were they added?\n  var checkArticleAge = function(topicId) {\n    new Article({topicId: topicId}).fetch().then(function(article){\n      if(article){\n        //console.log('oldest article', article.get('created_at'));\n        if(new Date - Date.parse(article.get('created_at')) > MAX_TIME) {\n          //time to update the database with alchemyAPI\n          refreshArticles(topicId);\n        } else {\n          //use articles in database\n          getArticles(topicId);\n        }\n      } else {\n        //need to populate the database with articles for this topic.\n        refreshArticles(topicId);\n      }\n    });\n  }\n\n  //1. does this topic exist in the topics table?\n  new Topic({name:req.query.topic})\n    .fetch()\n    .then(function(topic) {\n      if (!topic) {\n        var reqTopic = new Topic({name:req.query.topic})\n        reqTopic.save().then(function(topic){\n          checkArticleAge(topic.get('id'));\n        });\n      } else {\n        checkArticleAge(topic.get('id'));\n      }\n    });\n});\n\napp.get('*', (req, res) => {\n  res.sendFile(__dirname + '/public/index.html');\n});\n\napp.listen(PORT, function () {\n console.log('Express listening on port ' + PORT + '!');\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./server.js\n **/","module.exports = require(\"bluebird\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bluebird\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"underscore\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"underscore\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"request-promise\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"request-promise\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"express-session\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express-session\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = require(\"connect-session-knex\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"connect-session-knex\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 7\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 8\n ** module chunks = 0\n **/","var knex = require('knex') ({\n  // >>>>> Heroku Postgres DB\n\n  // client: 'pg',\n  // connection: process.env.DATABASE_URL\n\n  // >>>>> Local DB  \n  \n  client: 'mysql',\n  connection: {\n    host: '127.0.0.1',\n    user: 'root',\n    database: 'rep', \n    password: 'kk'\n  }\n});\n\nvar db = require('bookshelf')(knex);\n\ndb.knex.schema.hasTable('users').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('users', function (user) {\n      user.increments('id').primary();\n      user.string('name', 100).unique();\n      user.string('password', 100);\n      user.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('topics').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('topics', function (topic) {\n      topic.increments('id').primary();\n      topic.string('name', 255).unique();\n      topic.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('videos').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('videos', function (video) {\n      video.increments('id').primary();\n      video.string('title', 255);\n      video.string('url', 255);\n      video.integer('userId');\n      video.integer('topicId');\n      video.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('streams').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('streams', function (stream) {\n      stream.increments('id').primary();\n      stream.string('title', 255);\n      stream.string('url', 255);\n      stream.integer('userId');\n      stream.integer('topicId');\n      stream.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('articles').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('articles', function (article) {\n      article.increments('id').primary();\n      //article.string('title', 255);\n      article.string('url', 1024).unique();\n      article.integer('topicId');\n      article.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('userFavs').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('userFavs', function (userFav) {\n      userFav.increments('id').primary();\n      userFav.integer('userId');\n      userFav.integer('topicId');\n      userFav.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\ndb.knex.schema.hasTable('userTopics').then(function(exists) {\n  if (!exists){\n    db.knex.schema.createTable('userTopics', function (userTopic) {\n      userTopic.increments('id').primary();\n      userTopic.integer('userId');\n      userTopic.integer('topicId');\n      userTopic.timestamps();\n    }).then(function(table) {\n      console.log('Created Table', table);\n    });\n  }\n});\n\nmodule.exports = db;\n\n\n/** WEBPACK FOOTER **\n ** ./db/config.js\n **/","module.exports = require(\"knex\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"knex\"\n ** module id = 10\n ** module chunks = 0\n **/","module.exports = require(\"bookshelf\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bookshelf\"\n ** module id = 11\n ** module chunks = 0\n **/","var db = require('../config');\nvar bcrypt = require('bcrypt-nodejs');\nvar Promise = require('bluebird');\n\nvar User = db.Model.extend({\n  tableName: 'users',\n  hasTimestamps: true,\n  initialize: function() {\n\n  },\n  streams: function() {\n    return this.hasMany(Stream);\n  },\n  videos: function() {\n    return this.hasMany(Video);\n  },\n  checkPassword: function(checkPW, callback) {\n    bcrypt.compare(checkPW, this.get('password'), function(err, isMatch) {\n      callback(isMatch);\n    })\n  }\n});\n\nmodule.exports = User;\n\n\n//Add password hashing with bcrypt, etc\n\n\n/** WEBPACK FOOTER **\n ** ./db/models/user.js\n **/","module.exports = require(\"bcrypt-nodejs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"bcrypt-nodejs\"\n ** module id = 13\n ** module chunks = 0\n **/","var db = require('../config');\n\nvar Topic = db.Model.extend({\n  tableName: 'topics',\n  hasTimestamps: true,\n  streams: function() {\n    return this.hasMany(Stream);\n  },\n  videos: function() {\n    return this.hasMany(Video);\n  },\n  articles: function() {\n    return this.hasMany(Article);\n  }\n})\n\nmodule.exports = Topic;\n\n\n/** WEBPACK FOOTER **\n ** ./db/models/topic.js\n **/","var db = require('../config');\n\nvar Article = db.Model.extend({\n  tableName: 'articles',\n  hasTimestamps: true,\n  topic: function() {\n    return this.belongsTo(Topic);\n  }\n})\n\nmodule.exports = Article;\n\n\n/** WEBPACK FOOTER **\n ** ./db/models/article.js\n **/","module.exports = {\n  KEY: '5271f6ac77beb97a142fe534297b65aaebd9ed5a',\n  getNewsURL: (topic) => {\n    return `https://gateway-a.watsonplatform.net/calls/data/GetNews?outputMode=json&start=now-1d&end=now&count=50&apikey=${module.exports.KEY}&return=enriched.url.url&q.enriched.url.concepts.concept.text=${topic}`;\n  },\n\n  getTextURL: (link) => {\n    // return \n\n    /* --- FOR FULL URL TEXT USE BELOW ----\n\n    return `http://gateway-a.watsonplatform.net/calls/url/URLGetText?apikey=${module.exports.KEY}&outputMode=json&url=${link}`;\n    */\n  }\n};\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./alchemy.config.js\n **/"],"sourceRoot":""}